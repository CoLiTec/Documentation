# Инструкция для сборки дистрибутива CoLiTec

### Интеграционная машина

##### Windows:
- ОС Windows 10
- клиент [SVN](https://tortoisesvn.net) с поддержкой командной строки
- система создания инсталляторов для Windows [Inno Setup](http://www.jrsoftware.org/isdl.php#stable)
- Environment Variables: добавить в переменную Path пути к SVN клиент и Inno Setup
- авторизоваться через установленный клиент SVN в репозитории CoLiTec

### Подготовка к сборке

##### 1. Checkout\Update директории «Build»

##### 2. Установить номер версии в «Build\Version.xml»:
- добавить в начало дерева новую ветку \<version\>
- установить уникальное значение атрибута «name» для узла \<version\>
- установить значения \<major\>, \<minor\> и \<release\>
- в предыдущей ветке \<version\> убрать SVN-keywords $Rev$ и $Date$ (сами значения оставить)

##### 3. Добавить описание изменений для новой версии в «Build\Changelog.xml»:
- добавить в начало дерева новую ветку \<changelog\>
- установить уникальное значение атрибута «name» равное атрибуту «name» новой версии
- установить значения \<item\>: 
    - описание групп *"added"*, *"changed"* и других см. на сайте [keepachangelog.com](https://keepachangelog.com)
    - атрибут *class="as,sat,vs"* – определяет класс(ы) приложения к которому(-ым) относится данный \<item\>, если атрибут не указан, то данный \<item\> относится ко всем классам.
    - дополнительно см. пример \<changelog name="example"\> в файле «Build\Changelog.xml»

##### 4. Commit директории Build
> SVN автоматически установит значения узла \<build\> и атрибута «Date» в «Build\Version.xml».
> Таким образом версия дистрибутива привяжется к номеру ревизии в репозитории.

### Запуск сборки
##### Windows:
1. Checkout\Update директории «Build» в корень диска «С:\»
2. Выполнить команду в командной строке:
```sh
PowerShell -ExecutionPolicy Bypass -File "C:\Build\Windows\setup.ps1"
```

> На диске «C:\» будет создана директория «C:\CoLiTec-Make». В нее будет произведен экспорт модулей из репозитория, заданной в «Build\Version.xml» ревизии. Потом будут проведены корректирующие работы и собственно упаковка в инсталлятор отдельного набора модулей для каждого класса. После будет выведено сообщение об успешной сборке «Ok, operation is complete».

3. Все! Готовые инсталляционные пакеты CoLiTec будут находится в директории **«С:\CoLiTec-Make\Out»** 
